<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>摩尔体积温度外推计算器</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top left, #e8f1ff 0, #f5f7fa 45%, #eef3ff 100%);
      color: #2c3e50;
    }
    .app-container {
      max-width: 980px;
      margin: 32px auto 40px;
      padding: 0 16px;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 26px;
      letter-spacing: 0.5px;
    }
    .subtitle {
      margin: 0 0 20px;
      color: #667085;
      font-size: 13px;
    }
    .layout {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: flex-start;
    }
    .column {
      flex: 1 1 320px;
      min-width: 0;
    }
    .box {
      background: #ffffff;
      padding: 16px 18px;
      margin: 0 0 16px;
      border-radius: 10px;
      border: 1px solid #e0e4ee;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.04);
    }
    .box h3 {
      margin: 0 0 10px;
      font-size: 16px;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .box h3 span.tag {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
    }
    .form-row {
      display: flex;
      align-items: center;
      margin: 6px 0;
      gap: 8px;
      flex-wrap: wrap;
    }
    label {
      min-width: 170px;
      font-size: 13px;
      color: #374151;
    }
    input, select {
      padding: 5px 8px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background-color: #ffffff;
    }
    input:focus, select:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.25);
    }
    input[type="number"] {
      width: 130px;
    }
    button {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #ffffff;
      font-size: 13px;
      cursor: pointer;
      margin-top: 10px;
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.35);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(79, 70, 229, 0.45);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(79, 70, 229, 0.35);
    }
    .primary-actions {
      margin: 6px 0 14px;
    }
    .warning {
      color: #b91c1c;
      font-weight: 600;
      font-size: 13px;
      margin-top: 6px;
    }
    #result {
      font-size: 13px;
      line-height: 1.6;
      background: #f9fafb;
      border-style: dashed;
    }
    details {
      margin-top: 8px;
      font-size: 13px;
    }
    details summary {
      cursor: pointer;
      color: #4f46e5;
    }
    details > div {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 8px;
      background: #f3f4ff;
    }
    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: #6b7280;
    }
    @media (max-width: 640px) {
      .app-container {
        margin-top: 20px;
      }
      h1 {
        font-size: 20px;
      }
      label {
        min-width: 100%;
      }
      input[type="number"], select {
        width: 100%;
      }
      .primary-actions {
        text-align: right;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <h1>摩尔体积温度外推计算器 V<sub>m</sub>(T)</h1>
    <p class="subtitle">基于 0 K 体积 + 线膨胀系数的常温/任意温度摩尔体积估算，可选 Debye–Grüneisen 修正与 α<sub>L</sub> 区间不确定性。</p>

    <div class="layout">
      <!-- 左列：材料选择 + 输入 -->
      <div class="column">
        <!-- builtin DB -->
        <div class="box">
          <h3>选择材料 <span class="tag">内建数据库</span></h3>
          <div class="form-row">
            <label for="materialSelect">材料：</label>
            <select id="materialSelect" onchange="fillFromDB()">
              <option value="">手动输入</option>
              <option value="Mg (hcp/fcc)">Mg (hcp / fcc (亚稳))</option>
              <option value="Al (fcc)">Al (fcc)</option>
              <option value="Cu (fcc)">Cu (fcc)</option>
              <option value="Ni (fcc)">Ni (fcc)</option>
              <option value="Zn (hcp/fcc)">Zn (hcp / fcc (亚稳))</option>
            </select>
          </div>
          <p class="footer-note">选择材料后会自动填入推荐的 V₀、α<sub>L</sub> 等参数，你也可以直接覆盖为自定义数值。</p>
        </div>

        <!-- user input -->
        <div class="box">
          <h3>材料输入参数 <span class="tag">必填与可选</span></h3>

          <div class="form-row">
            <label for="structure">晶体结构：</label>
            <select id="structure">
              <option value="hcp">hcp</option>
              <option value="fcc">fcc</option>
            </select>
          </div>

          <div class="form-row">
            <label for="V0">0 K 摩尔体积 V<sub>0</sub> (cm³/mol)：</label>
            <input type="number" id="V0" step="0.0001">
          </div>

          <!-- 高级：从晶胞体积反算 V0 -->
          <details>
            <summary>高级：从晶胞体积 V<sub>cell</sub> 计算 V<sub>0</sub></summary>
            <div>
              <div class="form-row">
                <label for="Vcell">晶胞体积 V<sub>cell</sub> (Å³)：</label>
                <input type="number" id="Vcell" step="0.0001">
              </div>

              <div class="form-row">
                <label for="Ncell">晶胞中原子数 N<sub>cell</sub>：</label>
                <input type="number" id="Ncell" step="1">
              </div>

              <button type="button" onclick="computeV0FromCell()">由 V<sub>cell</sub> 计算 V<sub>0</sub></button>
              <p class="footer-note">
                使用公式：V<sub>0</sub> = V<sub>cell</sub> × N<sub>A</sub> / N<sub>cell</sub> × 10⁻²⁴ cm³/Å³，
                其中 N<sub>A</sub> = 6.02214076×10²³ mol⁻¹。
              </p>
            </div>
          </details>

          <div class="form-row">
            <label for="alphaL">线膨胀系数 α<sub>L</sub> (×10⁻⁶ K⁻¹)：</label>
            <input type="number" id="alphaL" step="0.01">
          </div>

          <div class="form-row">
            <label>α<sub>L</sub> 下界 / 上界 (×10⁻⁶ K⁻¹，可选)：</label>
            <input type="number" id="alphaL_min" style="width:90px;" placeholder="下界">
            <input type="number" id="alphaL_max" style="width:90px;" placeholder="上界">
          </div>

          <div class="form-row">
            <label for="thetaD">Debye 温度 θ<sub>D</sub> (K)：</label>
            <input type="number" id="thetaD">
          </div>

          <div class="form-row">
            <label for="gamma">Grüneisen 参数 γ：</label>
            <input type="number" id="gamma">
          </div>

          <div class="form-row">
            <label for="B">体模量 B (GPa)：</label>
            <input type="number" id="B">
          </div>

          <div class="form-row">
            <label for="T">目标温度 T (K)：</label>
            <input type="number" id="T" value="298">
          </div>
        </div>
      </div>

      <!-- 右列：计算与结果 -->
      <div class="column">
        <div class="box">
          <h3>计算与结果 <span class="tag">输出</span></h3>
          <div class="primary-actions">
            <button onclick="calculate()">计算摩尔体积</button>
          </div>
          <p id="warning" class="warning"></p>
          <div id="result" class="box">
            结果将显示于此：包括基于 α<sub>L</sub> 的外推体积、可选的不确定性区间，以及 Debye–Grüneisen 方法（若参数齐全）。
          </div>
        </div>
      </div>
    </div>

    <p class="footer-note">
      说明：本工具适用于基于 0 K DFT/实验体积与线膨胀系数的快速估算，若需论文级精度，建议结合 QHA 或 AIMD 进行验证。
    </p>
  </div>

  <!-- 外部材料数据库：用于根据元素+结构预填参数 -->
  <script src="materials_database.js"></script>

  <script>
    // 从外部 MATERIALS_DB 填充默认值（包括 0 K 体积或晶胞参数等）
    function fillFromDB() {
      const key = document.getElementById("materialSelect").value; // 如 "Mg (hcp/fcc)"
      if (key && typeof MATERIALS_DB !== "undefined" && MATERIALS_DB[key]) {
        const m = MATERIALS_DB[key];
        // 若数据库直接给了 0 K 摩尔体积，优先用它
        if (m.V0_cm3mol) {
          document.getElementById("V0").value = m.V0_cm3mol;
        }
        // 若给了晶胞体积和原子数，也一并填上，用户可选择用它反算 V0
        if (m.Vcell_A3) {
          document.getElementById("Vcell").value = m.Vcell_A3;
        }
        if (m.Ncell) {
          document.getElementById("Ncell").value = m.Ncell;
        }
        if (m.alpha_L_micro) {
          document.getElementById("alphaL").value = m.alpha_L_micro;
        }
        if (m.alpha_L_min_micro) {
          document.getElementById("alphaL_min").value = m.alpha_L_min_micro;
        }
        if (m.alpha_L_max_micro) {
          document.getElementById("alphaL_max").value = m.alpha_L_max_micro;
        }
        if (m.thetaD) {
          document.getElementById("thetaD").value = m.thetaD;
        }
        if (m.gamma) {
          document.getElementById("gamma").value = m.gamma;
        }
        if (m.B_GPa) {
          document.getElementById("B").value = m.B_GPa;
        }
      }
    }

    // 由晶胞体积 Vcell 和 Ncell 反算 0 K 摩尔体积 V0
    function computeV0FromCell() {
      const Vcell = parseFloat(document.getElementById("Vcell").value);   // Å³
      const Ncell = parseFloat(document.getElementById("Ncell").value);   // atoms
      if (isNaN(Vcell) || isNaN(Ncell) || Ncell <= 0) {
        alert("请正确输入晶胞体积 Vcell 和原子数 Ncell。");
        return;
      }
      const NA = 6.02214076e23; // Avogadro
      // V0(cm³/mol) = Vcell(Å³) * NA / Ncell * 1e-24
      const V0_cm3mol = Vcell * NA / Ncell * 1e-24;
      document.getElementById("V0").value = V0_cm3mol.toFixed(4);
    }

    // 主要计算
    function calculate() {
      const V0Val = parseFloat(document.getElementById("V0").value);
      const alphaLVal = parseFloat(document.getElementById("alphaL").value) * 1e-6;
      const TVal = parseFloat(document.getElementById("T").value);
      const thetaDVal = parseFloat(document.getElementById("thetaD").value);
      const gammaVal = parseFloat(document.getElementById("gamma").value);
      const BVal = parseFloat(document.getElementById("B").value);

      // αL 不确定性范围（若提供）
      const alphaLMinIn = document.getElementById("alphaL_min").value;
      const alphaLMaxIn = document.getElementById("alphaL_max").value;
      const alphaLMin = alphaLMinIn !== "" ? parseFloat(alphaLMinIn) * 1e-6 : NaN;
      const alphaLMax = alphaLMaxIn !== "" ? parseFloat(alphaLMaxIn) * 1e-6 : NaN;
      const key = document.getElementById("materialSelect").value;
      const struct = document.getElementById("structure").value;

      // 从外部 DB 读元素符号，用于亚稳相提示
      let elementSymbol = "";
      if (key && typeof MATERIALS_DB !== "undefined" && MATERIALS_DB[key]) {
        elementSymbol = MATERIALS_DB[key].element;
      }

      let warn = "";
      if ((elementSymbol === "Mg" || elementSymbol === "Zn") && struct === "fcc")
        warn = "⚠ 亚稳相！结果仅供参考，强烈建议 QHA 或 AIMD 验证。";
      document.getElementById("warning").innerText = warn;

      if (isNaN(V0Val) || isNaN(alphaLVal) || isNaN(TVal)) {
        document.getElementById("result").innerHTML = "<b>请至少输入 V₀、αL 和 T。</b>";
        return;
      }

      const alphaV = alphaLVal * 3;
      const Vm_lin = V0Val * (1 + alphaV * (TVal - 0));

      // 若给了 αL 的下界/上界，也给出对应区间
      let rangeText = "";
      if (!isNaN(alphaLMin) && !isNaN(alphaLMax)) {
        const alphaVmin = alphaLMin * 3;
        const alphaVmax = alphaLMax * 3;
        const Vm_min = V0Val * (1 + alphaVmin * (TVal - 0));
        const Vm_max = V0Val * (1 + alphaVmax * (TVal - 0));
        rangeText = `<br>在 αL ∈ [${(alphaLMin*1e6).toFixed(1)}, ${(alphaLMax*1e6).toFixed(1)}]×10⁻⁶ K⁻¹ 时，Vₘ(${TVal.toFixed(2)} K) ≈ ${Vm_min.toFixed(3)} – ${Vm_max.toFixed(3)} cm³/mol`;
      }

      // Debye–Grüneisen 公式保持为可选的第二种方法（若参数齐全才显示）
      let dgText = "";
      if (!isNaN(thetaDVal) && !isNaN(gammaVal) && !isNaN(BVal)) {
        const R = 8.314;
        const Vm_DG = V0Val * (1 + gammaVal * R * TVal / (BVal * 1e9 * 1e-6));
        dgText = `<br>方法 B（Debye–Grüneisen）：<b>${Vm_DG.toFixed(3)}</b> cm³/mol`;
      }

      document.getElementById("result").innerHTML = `
        <b>计算结果：</b><br><br>
        方法 A（常数热膨胀系数外推）：<b>${Vm_lin.toFixed(3)}</b> cm³/mol<br>
        ${dgText}
        ${rangeText}
        <hr>
        0 K 输入/换算 V₀ = ${V0Val.toFixed(4)} cm³/mol<br>
        目标温度 T = ${TVal} K
      `.trim();
    }
  </script>
</body>
</html>